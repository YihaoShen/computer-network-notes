## 本章最重要的内容

1. 虚拟互联网的概念
2. IP地址与物理地址的关系
3. 传统分类的IP地址（包括子网掩码的概念）
4. 路由选择协议的工作原理

### 网络层该向运输层提供怎样的服务？（面向连接还是无连接）?

如果是使用面向连接的通信方式，则需要首先建立一条虚电路（Virtual Circuit）,用来预留双方通信所需的一切资源。双方就沿着建立起来的虚电路发送分组通信结束后，要释放建立起来的虚电路网络资源。传送过程如图所示:
   
![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013058203-949580540.png)


特点是：分组传输过程中可靠，不会丢失，也不重复。（被抛弃）

因此选择的是：**网络层向上只提供简单灵活的，无连接的，尽最大努力交付的数据报服务（分组或IP数据报）**,网络层在发送分组的时候，并不需要先建立连接，每一个分组（IP数据报）独立发送，与前后的分组无关网络层不提供服务质量的承诺。传递过程如图所示

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013114668-1481148623.png)

 
虚电路与数据报服务的区别

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013133485-320215226.png)


## 网际协议IP

网际协议又称为**Kahn-Cerf协议**，是TCP/IP协议中最主要的协议之一，我们所讲的IP协议其实已经是第四个版本了，应该记为**IPV4**。与IP协议配套使用的还有以下协议：

1. 地址解析协议ARP(Address Resolution Protocol)

2. 网际控制报文协议ICMP协议(Interner Control Message Protocol)

3. 网际组管理协议IGMP(Internet Group Management Protocol)

如图就是他们之间的联系图

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013153261-663647883.png)
 
ARP画在IP下面，代表了**IP协议要使用ARP协议**。ICMP和IGMP画在IP上面，代表了**ICMP和IGMP要使用IP协议**

### 虚拟互联网络

将网络互相连接在一起需要使用一些**中间设备**，根据中间设备所处的层次，我们可以分为：

1. 物理层使用的叫做**转发器**
2. 数据链路层使用的叫做**网桥或交换机**
3. 网络层使用的叫做**路由器**
4. 网络层以上的叫做**网关**，用网关连接两个不兼容的系统需要经过高层进行协议的转换。

许多计算机网络通过路由器进行互连，由于许多计算机使用的都是使用**IP网际协议**，因此互联的计算机可以看成如图所示的**虚拟互联网络**。

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013224641-705640694.png)

这种使用**IP协议的的虚拟网络称之为IP网**,注意！！！如果IP网上层的运输层使用的是TCP协议，那么该IP网就是现在的互联网

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013249096-1330712312.png)

当不同的局域网使用路由器连接起来后，如果所有的网络层都是用相同的IP协议，那么在网络层讨论问题就十分简单.
我们首先看一下主机H1要把一个IP数据报发送到目的主机H2的过程

![](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804013315056-1328119494.png)

主机H1先要查自己的路由表，看目的主机是否在本网络上

如果是，则不需要经过任何路由器而是**直接交付**,如果不是，则必须把**IP数据报**发送给某个路由器（例如图中的R1），R1路由器在查表后再将该**IP数据报**交给R2路由器**间接交付**，这样一直下去，直到R5路由器和H2在同一个网段上，R5路由器把IP数据报交给H2主机。
