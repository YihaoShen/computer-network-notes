### 分类的IP地址

有关IP最重要的文档就是互联网的正式标准**RFC 791**

#### IP地址及其表示方法

整个互联网就是一个**单一，抽象的网络**，IP地址就是给互联网上的每一台主机（或者路由器）的每一个接口分配一个在全世界范围内都是唯一的32位的标识符。**IP地址的出现是为了我们更方便的寻址**。 IP地址现在是由**ICANN**进行分配。

IP地址编码三大阶段:

1. 分类的IP地址：是最基本的编址方法。
2. 子网的划分：对最基本的编址方法进行改进。
3. 构建超网：比较新的无分类的编址方法。

所谓的**分类的IP地址**就是将IP地址划分为若干个固定类，每一类地址都由两个固定长度的字段组成。第一个字段为**网络号**，第二个字段为**主机号**，一个网络号在整个互联网范围内必须是唯一的，一个主机号在某一个网络区间内必须是唯一的。
由此可见，**一个IP地址在整个互联网范围都是唯一的**。
这种两级的IP地址可以记为：
![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214043943-1882429441.png)


 IP地址不仅仅指明一台主机，还指明该主机所连接到的互联网络。

![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214100366-226109447.png)
注意这里A类，B类，C类都是单播地址（一对一通信），且是最常用的。D类地址用于多播（一对多通信），E类地址保留为以后使用。

### 常见的三种类别的IP地址

A类地址：网络号字段占1个字节，只有7位可以使用(该字段的第一位已经固定为0)，可以指派的网络号是$2^7$-2=126个。-2的目的是：
1. IP地址中的全0表示的是"这个",网络号字段全为0的IP是个保留地址，意思是本网络。
2. 网络号位127(0111111)作为本地软件**环回测试(loopback test)**,本主机进程之间的通信使用，意思就是若主机发送了一个目的地址为环回地址例如127.0.0.1的IP数据包，主机并不会发送到网络上。环回地址永远都不会出现在任何网络上，因为网络号位127根本就不是一个网络地址。

A类地址主机号占3个字节（24位）,因此每一个A类网络中最大的主机数位$2^24$-2=16777214,-2的原因是

1. 全0的主机号字段表示该IP地址是“本主机”所连接到的**单个网络地址**(例如，一个主机的IP地址是5.6.7.8，那么该主机所在的网络地址为5.0.0.0)
2. 
3. 全1表示**所有的(all)**，因此全为1的主机号字段表示的是该网络上的所有主机。

B类地址：网络号字段有2个字节16位，但前两位(1 0)已经固定了，只剩下14位可以进行分配。因为网络号字段后面的14位不论如何取值也不可能出现使整个2字节的网络号字段变为全0或全1，因此这里网络书-2的问题。但实际上B类网络地址128.0.0.0是不指派的，而可指派的B类最小网络地址是128.1.0.0.因此B类地址可指派的的网络数为$2^14$-1,即16383，B类地址的每一个网络上最大的主机数是$2^16$-2,即65534，这里减2的目的是因为要扣除全0和全1的主机号。

 C类地址：网络号3个字节24位，网络号前必须是110，因此还有24-3=21位可以进行分配，C类地址可指派的网络总数是$2^21$-1，即2097151个。C类地址主机位占1个字节，即8位，每一个C类地址的最大主机数为$2^8$-2,即254个。

 这样我们就得出了如图4-2所表示的IP地址的指派范围：   
 
 ![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214117222-455412295.png)

图4-3给出了一般不使用的特殊IP地址，这些地址只能在特定的情况下使用:

![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214129896-775494042.png)

IP地址具有如下特征

1. 每个IP都是由网络号和主机号两部分组成。从这个意义上来说，IP地址是一种**分等级的地址结构**,分两个等级的好处是:
   
   * IP地址管理机构在分配IP地址时只分配网络号（第一级），而剩下的主机号（第二级）则由得到该网络的单位自行分配。这样就方便了了IP地址的管理；

   * 路由器仅仅根据目的主机所连接的网络号来分组转发（并不考虑主机号）这样就可以使路由表中的项目数打大幅度减少，从而减少了路由表所占的内存存储空间以及查找路由表的时间。

2. 实际上IP地址标志着一台主机（或者路由器）和一条链路的**接口**，当一台主机同时连接到两个网络上时，则该主机必须同时拥有两个相应的IP地址，并且网络号必须是不同的。这样的主机称之为**多归属主机**，由于一个路由器至少应当连接到两个网络，因此一个路由器应该至少有两个不同的IP地址，举个简单的例子：有一个建筑正好在北京路和上海路的交叉口上那么这两个建筑可以同时拥有两个门牌号码:例如北京路4路和上海路37路。

3. 按照互联网的观点，一个网络指具有相同网络号net-id的主机的集合，因此，使用转发器或者网桥连接起来的若干局域网仍为一个网络，因为这些网络具有相同的网络号，具有不同网络号的主机必须要通过路由器进行连接。

4. 在IP地址中，所有分配到网络号的网络都是平等的--互联网同等对待每一个IP地址。

### IP地址与硬件地址

**硬件地址与IP地址的区别**

从层次上来看，物理地址是数据链路层和物理层使用的地址，而IP地址是网络层及其上层使用的地址，因此也叫做逻辑地址(IP地址是用软件实现的)。

![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214146524-2124806601.png)

在发送数据的时候，数据从高层下到低层，然后才能在通信链路上通信，使用IP地址的数据报一旦交给了数据链路层，就会被封装成MAC帧。MAC帧在传输的时候使用的源地址和目的地址都是硬件地址，这两个硬件地址都写入了MAC帧的首部中。

连接在通信链路上的设备（主机或者路由器）在收到MAC帧的时，根据MAC帧首部中的硬件地址决定收下还是丢弃。只有在剥去MAC帧的首部和尾部才能把MAC帧的数据上交到网络层后，网络层才能在IP数据报的首部找到源IP地址和目的IP地址。

当IP数据报放到链路层的MAC帧中，整个IP数据报就成了MAC的数据，因此在数据链路层看不到数据报的IP地址。

如图4-9(a)画的是三个局域网使用两个不同的路由器R1和R2互连起来。现在主机H1和H2进行通信，这两台主机的IP地址分别是IP1和IP2，而它们的硬件地址分别为HA1和HA2。通信的路径是：H1->经过R1转发->再经过R2转发->H2。路由器R1因同时连接到两个局域网上，因此它有两个硬件地址，即HA3和HA4，同理，路由器R2也有两个硬件地址HA5和HA6。

![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214208952-17869494.png)

图4-9(b)特别强调了IP地址与MAC地址之间的关系,表4-4归纳了这种区别。

![image](https://img2020.cnblogs.com/blog/2361214/202108/2361214-20210804214224596-920892825.png)

这里要强调几点

1. 在IP层抽象的互联网上只能看到IP数据报，虽然IP数据报要经过路由器R1和R2的两次转发，但在它的首部中的源地址和目的地址始终是IP1和IP2，数据报中间经过的两个路由器的IP地址并不会出现在IP数据报的首部中。

2. 虽然在IP数据报首部有源IP地址，但是路由器只根据目的IP地址的网络号进行路由选择。

3. 在局域网的链路层，只能看到MAC帧，IP数据报在被封装到MAC帧中.MAC帧在不同的网络上传输时。其MAC帧首部的源MAC地址和目的MAC地址都要发送变化，如上图4-9(b)。

4. 尽管互联在一起的网络的硬件地址体系各不同。但是IP层抽象的的互联网屏蔽了下层这些很复杂的细节，我们只需要在网络层上讨论问题，就能够使用统一的，抽象的IP地址来研究主机和主机或者主机和路由器之间的通信。
