46. 试用具体例子说明为什么在运输建立连接时要使用三次握手，说明如果不这样做可能会发生什么情况？
    
    > 如图T-5-46给出了一个例子
    > 
    >   在上一个TCP连接中，A向B发送的连接请求报文SYN报文段滞留在了网络中的某处。于是A超时重传，与B建立了连接，交换了数据，最后也释放了TCP连接。
    > 
    > 但滞留在网络中某处的陈旧的SYN 报文段，现在突然传送到 B了。如果不使用三报文握手，那么B就以为A现在请求建立TCP连接，于是就分配资源，等待A传送数据。但A并没有想要建立TCP 连接，也不会向 B 传送数据。B 就白白等待着 A 发送数据。
    > 
    > 如果使用三报文握手，那么B在收到A发送的陈旧的SYN报文段后，就向A发送SYN报文段，选择自己的序号 seq =y， 并确认收到A的SYN报文段，其确认号ack=x+1。当A收到B的SYN报文段时，从确认号就可得知不应当理睬这个SYN报文段（因为A 现在并没有发送seq=x的SYN报文段）。这时，A 发送复位报文段。在这个报文段中，RST = 1，ACK=1，其确认号ack=y＋1。我们注意到，虽然A拒绝了TCP连接的建立（发送了复位报文段），但对B发送的SYN报文段还是确认收到了。
    > 
    > B收到A的RST报文段后，就知道不建立连接，不会等待A发送数据了。

47. 一客户向服务器请求建立TCP连接，客户在TCP连接建立的三报文握手中的最后一个报文段中捎带上一些数据，请求服务器发送一个长度为L字节的文件。假定：
    
    1. 客户和服务器之间的数据传送速率时R字节/秒，客户与服务器之间的往返时间为RTT（固定值）。
    
    2. 服务器发送的TCP报文段的长度都是M字节，而发送窗口大小是nM字节。
    
    3. 所有传送的报文段都不会出现差错（无重传），客户在接收到服务器发送的报文段后立即发送确认。
    
    4. 所有协议的首部开销可以忽略，所有确认报文段和连接建立阶段的报文段的长度可以忽略。

试证明，从客户开始发起连接建立到接收服务器发送的整个文件所需下载时间T是：

T=2RTT+L/R(当nM>R(RTT+M))或者T=2RTT+L/R+(K-1)[M/R+RTT-nM/r](当nM

其中K=[L/nM]，符号[x]表示若x不是整数，则把x整数部分+1。

> 先看图T-5-47(a)。
> 
> M/R是一个报文段的发送时间（一个报文段的长度除以数据率）
> 
> nM是窗口大小，nM/R是把窗口内的数据都发送完所需要的时间。
> 
> 如果nM/R>M/R+RTT，即窗口内所属有数据发送完的时间>一个报文段发送完的时间。那么服务器在发送窗口内的数据还没有发送完，就就收到客户的确认，因此，服务器可以连续发送，直到全部数据发送完毕。
> 
> 这个不等式两边同时乘以R，可以得出：nM=M+R(RTT)。
> 
> 当nM>M+R(RTT)时，发送窗口内的数据还没来得及发送完就确认，因此服务器可以连续发送，知道全部数据发送完毕。
> 
> 因此客户端接收全部数据所需要的时间是：
> 
> T=2RTT+L/R
> 
> 再看图T-5-47(b)。
> 
> 当nM
> 
> 整个文件L要划分为K=[L/nM]次传送，停止的时间有K-1个，这样就证明了求证的公式：T=2RTT+L/R+(K-1)[M/R+RTT-nM/R]





48. 网络允许的最大报文段长度为 128 字节，序号用 8 位表示，报文段在网络中的
    寿命为30秒。求发送报文段的一方所能达到的最高数据率。

> 本题可以排除掉不是使用TCP协议，因为TCP协议序号为32位，而本题序号为8位
> 
> 报文段的传送应当使用的是滑动窗口协议，而不是停止等待协议。滑动窗口协议的传输效率比较高。
> 
> 在使用滑动窗口协议时，在没有收到确认的情况下，8位的序号字段可连续发送255个序号($2^8-1=255$)的报文段。
> 
> 这时，一共可发送的比特数是：$128x255x8=261120bit$。
> 
> 算出发送报文段一方所能达到的最高速率为$261120bit/30s=8.704kbit/s$

49. 下面是以16进制格式 存储的一个UDP首部：CB84000D001C001C，试问：
    
    1. 源端口是什么？
    
    2. 目的端口号是什么？
    
    3. UDP用户数据报总长度是多少？
    
    4. 数据长度是多少？
    
    5. 这个分组是客户到服务器方还是服务器方到客户方？
    
    6. 客户进程是什么？

> | 源端口号（第一个前四位）                          | 目的端口号（第二个前四位） | UDP分组长度（第三个前四位）       | 数据长度            |
> | ------------------------------------- | ------------- | --------------------- | --------------- |
> | CB84(16)                              | 000D(16)      | 001C(16)              | 分组长度-首部长度       |
> | $12x16^3+11x16^2+8x16^1+4x16^0=52100$ | $13x16^0=13$  | $1x16^1+12x16^0=28字节$ | $28字节-8字节=20字节$ |
> 
> UDP校验和：001C：$1x16^1+12x16^0=28$
> 
> 
> 
> 因为目的端口是13，所以该分组时客户到服务器的。
> 
> 这个客户进程时Daytime。当Daytime服务器收到客户端发送的UDP用户数据报后，就把现在的时间和日期以ASCII码字符串的形式返回给客户。





50. 把教材上的图 5-7 计算 UDP验和的例子自己具体演算一下，看是否能够得出书上的计算结果。

> 如图所示：
> 
> 
