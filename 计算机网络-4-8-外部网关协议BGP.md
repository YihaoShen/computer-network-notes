## 外部网关协议BGP

1989年，公布了新的外部网关协议BGP，我们目前使用最多的版本是BGP-4(但仍然是起草方案\[RFC 4271])，简写为BGP。

在不同的自治系统AS中之间的路由选择为什么不选择前面讨论的内部网关协议，如RIP或者OSPF？我们知道，内部网关协议(如RIP或RSPF)主要是设法使数据报在一个AS当中尽可能从源站发送到目的站。然而BGP使用的环境却不同，这主要有以下两种原因：

1.  **互联网的规模太大，使得自治系统AS之间路由选择非常困难**。连接在互联网主干上的路由器，必须对任何有效的IP地址都能在路由表中找到匹配的目的网络。目前在互联网的路由器中，一个路由表的数目早已超过5万个网络前缀。如果使用链路状态协议，则每一个路由器必须维持一个很大的链路状态数据路，对于这么大的主干网，迪杰斯特拉算法计算最短路径时花费的时间也太长。另外，不同的AS自治系统运行着自己选择特定的内部路由选择协议，并使用本AS指明的路径长度。比较合理的做法是在自治区系统之间交换**可达性**信息(即“可到达”或者“不可到达”)，例如，告诉相邻路由器：“到达目的网络N可以经过自治系统ASx”。

2.  **自治系统AS之间的路由选择必须考虑有关策略**。由于相互连接的网络的性能相差很大，根据最短路径(即最小跳数)找出来的路径，可能并不合适。还有一种情况，如自治系统AS1要发送的数据报给自治系统AS2，本来是最好经过AS3，但AS3并不愿意让这些数据报通过本自治区的网络，因为“这是他们的事，和我们没有关系”。因此，自治系统之间的路由选择应当允许使用多种路由选择策略。使用这些策略是为了找出更好的路径而不是最佳的路径。

由于上述情况，边界网关协议BGP只能时力求寻找一条能够到达目的网络且**比较好的**的路由(不能兜圈子)，而**并非要找一条最佳路由**，BGP采用了**路径向量(path vector)路由选择协议**，它与距离向量协议(如RIP)和链路状态协议(如OSPF)都有很大的区别。

在配置BGP的时候，每一个自治系统的管理员要选择至少一个路由器作为该自治系统的**BGP发言人**。一般来说，两个BGP发言人都是通过一个共享网络连接在一起的，而BGP发言人往往就是**BGP边界路由器**，但也可以不是BGP边界路由器。

一个BGP发言人与其他AS的BGP发言人要交换路由信息，就要先建立起TCP连接(端口号为179)，然后在此连接上交换BGP报文以建立**BGP会话(session)**，利用BGP会话交换路由信息，如增加了新的路由，或撤销过时的路由，以及报告出差错情况等等。使用TCP连接能提供可靠的服务，也简化了路由选择协议。使用TCP连接路由信息的两个BGP发言人，彼此成为对方的**邻站(neighbor)或**对等站(peer)。

图4-38表示BGP发言人和自治系统AS之间的关系示意图。在图中画出了三个自治系统中的5个BGP发言人，每个BGP发言人除了必须运行BGP协议模块外，还必须要运行该自治系统内部的内部网关协议，例如OSPF协议或者RIP协议。
![](2021-12-19-23-19-02jcitf.png)

边界网关协议BGP所交换的网络可达性的信息就是要到达某个网络(用网络前缀表达式)所要经过的一系列自治系统